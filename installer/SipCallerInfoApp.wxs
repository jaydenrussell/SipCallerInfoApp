<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Name="SIP Caller Info App" Language="1033" Version="1.0.0.0" Manufacturer="Jayden Russell" UpgradeCode="0647b086-b1b4-582d-9b4d-bfc142dcf225">
    <Package InstallerVersion="500" Compressed="yes" InstallScope="perMachine" />

    <!-- Ensure upgrades uninstall prior versions automatically -->
    <MajorUpgrade AllowDowngrades="no" DowngradeErrorMessage="A newer version of SIP Caller Info App is already installed." />

    <MediaTemplate />

    <Feature Id="MainFeature" Title="SIP Caller Info App" Level="1">
      <ComponentGroupRef Id="AppComponents" />
      <ComponentRef Id="StartMenuShortcutComponent" />
      <ComponentRef Id="UninstallShortcutComponent" />
    </Feature>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLDIR" Name="SipCallerInfoApp" />
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ProgramMenuDir" Name="SipCallerInfoApp" />
      </Directory>
    </Directory>

    <DirectoryRef Id="ProgramMenuDir">
      <!-- App shortcut -->
      <Component Id="StartMenuShortcutComponent" Guid="2dcdf040-18c9-4179-956e-24c7d1632aba">
        <Shortcut Id="StartMenuShortcut" Name="SIP Caller Info App" Description="Caller ID desktop integration" Target="[INSTALLDIR]SipCallerInfoApp.exe" WorkingDirectory="INSTALLDIR" />
        <RemoveFolder Id="RemoveStartMenuDir" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\SipCallerInfoApp" Name="installed" Type="integer" Value="1" KeyPath="yes" />
      </Component>

      <!-- Uninstaller shortcut: calls msiexec to remove current ProductCode -->
      <Component Id="UninstallShortcutComponent" Guid="4c5ba5ef-313e-444d-a4ec-4086d3dbb9ff">
        <Shortcut Id="UninstallShortcut" Name="Uninstall SIP Caller Info App" Description="Remove SIP Caller Info App" Target="[System64Folder]msiexec.exe" Arguments="/x [ProductCode]" />
        <RemoveFolder Id="RemoveStartMenuDir2" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\SipCallerInfoApp" Name="uninstallShortcut" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </DirectoryRef>

    <!-- ComponentGroup 'AppComponents' will be generated by heat.exe from publish folder -->
    <ComponentGroup Id="AppComponents" />
  </Product>
</Wix>
